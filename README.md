# 🚀 GAS TypeScript + Vite Template

[![TypeScript](https://img.shields.io/badge/typescript-007ACC?logo=typescript)](https://www.typescriptlang.org/)
[![vite](https://img.shields.io/badge/bundler-vite-blue)](https://vitejs.dev/)
[![clasp](https://img.shields.io/badge/clasp-enabled-brightgreen)](https://github.com/google/clasp)
[![Volta](https://img.shields.io/badge/volta-managed-4B32C3?logo=volta)](https://volta.sh)
[![Husky](https://img.shields.io/badge/husky-enabled-2B7BB9)](https://typicode.github.io/husky/)
[![Prettier](https://img.shields.io/badge/prettier-enabled-F7B93E?logo=prettier)](https://prettier.io/)

A minimal template for developing Google Apps Script (GAS) using **TypeScript**, **Vite**, and **clasp**.

## ✨ Features

- ✅ TypeScript with modern ESNext syntax
- ✅ Fast bundling with Vite
- ✅ Easy deployment to Google Apps Script via `clasp`
- ✅ Module aliasing with `@/`
- ✅ Git hook formatting with Husky and Prettier
- ✅ Volta for consistent Node.js and npm versions

## 🏁 Getting Started

### 1. Install dependencies

```bash
npm install
```

- If you're using [Volta](https://volta.sh), it will automatically manage your Node.js and npm versions.  
  See the [Toolchain Management](#️-toolchain-management-via-volta) section below for more details.

### 2. Login to clasp

```bash
npx clasp login
```

### 3. Connect to a GAS project

You have two options:

#### **👉 Clone an existing project**

```bash
npx clasp clone <script-id>
```

- The Script ID can be found in the **Project Settings** of your Apps Script project.  
  In the editor, click the gear icon (⚙️) in the sidebar and look for the Script ID section.

#### **👉 Create a new project**

```bash
npx clasp create --title "My Script" --type standalone
```

**Option Descriptions:**

- `--title` : Name of the Apps Script project
- `--type` : Container type (`docs`, `sheets`, `forms`, etc.)

✅ After cloning or creating a project, a `.clasp.json` file will be generated in your project root.

You **must edit** the [`.clasp.json`](.clasp.json) to specify the correct build output directory:

```json
{
  "scriptId": "<your-script-id>",
  "rootDir": "./dist"
}
```

This ensures clasp pushes the compiled code in the `dist/` folder (generated by Vite) to Google Apps Script.

### 4. Build the project

```bash
npm run build
```

This will output your script to [`dist/main.gs`](./dist/main.gs).

### 5. Push to Google Apps Script

```bash
npm run push:only
```

or you can combine build and push:

```bash
npm run push
```

## 📁 Project Structure

```text
.
├── appsscript.json     # GAS project manifest (copied to dist/)
├── .clasp.json         # clasp configuration (should be gitignored)
├── tsconfig.json       # TypeScript compiler config
├── vite.config.ts      # Vite + Rollup build config
├── src/                # Your TypeScript source code
│   ├── main.ts         # Entry point
│   ├── app.ts          # Main application logic
│   └── ...             # More modules (called from app.ts)
└── dist/               # Output directory for deployment
```

### 📌 `main.ts` and `app.ts`

**[`main.ts`](./src/main.ts):**

Acts as the entry point for the GAS runtime.  
It registers top-level functions (like `run`) to `globalThis` so they can be called from GAS UI.

**[`app.ts`](./src/app.ts):**

Contains the core application logic, such as logging and invoking feature modules (e.g., [`greeting`](./src/features/greet.ts)).  
Keeps main.ts minimal and focused solely on exposing functions.

## 🧪 Scripts

| Command               | Description                                        |
| --------------------- | -------------------------------------------------- |
| `npm run build`       | Build TypeScript with Vite and output to `dist/`   |
| `npm run push`        | Build and push `dist/` files to Google Apps Script |
| `npm run push:only`   | Push `dist/` files without rebuilding              |
| `npm run build:watch` | Watch and rebuild on file changes                  |
| `npm run push:watch`  | Watch and auto-push on changes                     |
| `npm run open`        | Open the Apps Script project in your browser       |
| `npm run deploy`      | Create a versioned deployment via `clasp deploy`   |
| `npm run prepare`     | Set up git hooks using `husky`                     |

## 🔒 .gitignore recommendations

```text
.clasp.json
dist/
.env
```

Make sure to add `.clasp.json` to your `.gitignore` file to avoid committing sensitive information like your Script ID.

## ⚙️ Toolchain Management via Volta

This project uses Volta to pin Node.js and npm versions for consistent development environments.

### ✅ If you're using Volta

You’re all set! Volta will automatically use the pinned versions defined in [`package.json`](./package.json). Just run:

```bash
npm install
```

### 🚫 Not using Volta?

No problem! You can still use this project.

Just make sure your local versions of Node.js and npm are close to the versions specified in [`package.json`](./package.json).

## 🧠 Tips

- `globalThis.func = ...` is used to expose functions to GAS runtime.
- This project supports module aliasing: use `@/` to refer to the `src/` directory for cleaner imports.
- Git hook formatting is enabled using [Husky](https://typicode.github.io/husky) and [Prettier](https://prettier.io/), which auto-formats staged files on commit via `lint-staged`. If you prefer not to use it, you can safely delete the [`.husky/`](.husky) folder.
- You can manage secrets or environment-specific variables using a `.env` file.
